<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /docs/mdsource/RefactoringTutorial.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Refactoring To Async Tutorial

<!-- toc -->
## Contents

  * [Prep](#prep)
  * [Step by Step](#step-by-step)
  * [Notes](#notes)
    * [Template](#template)
    * [1. Call the method in question from a test](#1-call-the-method-in-question-from-a-test)
    * [2. Take the 1st thing to move to async and create an `InputPipe` of it's parameters directly above it.](#2-take-the-1st-thing-to-move-to-async-and-create-an-inputpipe-of-its-parameters-directly-above-it)
    * [3. Place a ApprovalTests to get insight into the pipeline.](#3-place-a-approvaltests-to-get-insight-into-the-pipeline)
    * [4. Inspect result in VsCode](#4-inspect-result-in-vscode)
    * [5. Add a process as a delegate](#5-add-a-process-as-a-delegate)
    * [6. Add a collector, and send input in](#6-add-a-collector-and-send-input-in)
    * [7. Process and Collect the next step in the pipeline](#7-process-and-collect-the-next-step-in-the-pipeline)
    * [8. (optional) Delete dead code](#8-optional-delete-dead-code)
    * [9. Goto step 7](#9-goto-step-7)
  * [Handling multiple parameters](#handling-multiple-parameters)
<!-- endtoc -->



## Prep

* Download the [sample exercise](https://github.com/refactoring-pipelines/PipelinesExercise) 
* Install the VsCode and the plugin [Graphviz (dot) language support for Visual Studio Code](https://marketplace.visualstudio.com/items?itemName=joaompinto.vscode-graphviz) by Jo√£o Pinto
CTRL-SHIFT-V to preview a `.dot` file as a rendered graph.


## Step by Step

## Notes

 1. All pipeline setup code occurs at the top of the method.
 2. Then the approvals call
 3. Then the sending through the pipeline

### Template 

```cs
// Set up Pipeline
// ApprovalPipeline
// Send thru pipeline
// Original code
```
### 1. Call the method in question from a test

Simply call the method you wish to refactor from a test.
Don't think of this as a traditional unit test. Think of it more as a specialized `main()` method

### 2. Take the 1st thing to move to async and create an `InputPipe` of it's parameters directly above it.

``` cs
var startingPointInput = new InputPipe<InputType>("InputName");
```

### 3. Place a ApprovalTests to get insight into the pipeline.

Place this right in the middle of the production code you want to refactor. It is a temporary step.

``` cs
PipelineApprovals.Verify(startingPointInput);
```

With a DotReporter (on the test)

``` cs
[UseReporter(typeof(DotReporter))]
```

### 4. Inspect result in VsCode

### 5. Add a process as a delegate

If the code isn't in a method, extract it to one first

``` cs
 var methodCallPipe = startingPoint.Process(TheMethodCall)
```

Do this above the `approvals.Verify()`. Run it again for feedback

### 6. Add a collector, and send input in

``` cs
 var methodCallCollector = methodCallPipe.Collect();
 startingPoint.Send(firstParameter);
 var variable = methodCallCollector.SingleResult;
```

### 7. Process and Collect the next step in the pipeline

### 8. (optional) Delete dead code

### 9. Goto step 7

## Handling multiple parameters

Everything is a single parameter. To use multiple, you'll have to join them into tuples. If this is requires new inputs, you'll need multiple input pipes
